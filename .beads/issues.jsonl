{"id":"go-unifi-mcp-08v","title":"Phase 4: MCP Server Core","description":"**BEFORE STARTING:** Read the full implementation plan at:\n/Users/coneill/.claude/plans/enchanted-imagining-breeze.md\n\n## Steps\n1. Implement config loading from env vars (`internal/config/`)\n2. Implement go-unifi client wrapper with mock interface for testing\n3. Implement MCP server using official Go SDK (`internal/server/`)\n4. Implement eager mode (register all tools)\n5. Write tests using in-memory transport (90%+ coverage)\n\n## Environment Variables\n```bash\n# Required\nUNIFI_HOST=https://192.168.1.1    # UniFi Controller URL\n\n# Authentication (one method required)\nUNIFI_API_KEY=your-api-key        # Preferred method\n# OR\nUNIFI_USERNAME=admin              # Alternative: username\nUNIFI_PASSWORD=secret             # Alternative: password\n\n# Optional\nUNIFI_SITE=default                # Default: \"default\"\nUNIFI_VERIFY_SSL=true             # Default: true\nUNIFI_TOOL_MODE=lazy              # Default: \"lazy\" (or \"eager\")\n```\n\n## Test Harness: In-Memory MCP Transport\nThe Go MCP SDK provides `NewInMemoryTransports()` for testing:\n```go\nfunc TestToolExecution(t *testing.T) {\n    server := NewServer(testConfig)\n    serverTransport, clientTransport := mcp.NewInMemoryTransports()\n    serverSession, _ := server.Connect(ctx, serverTransport, nil)\n    clientSession, _ := mcp.NewClient(...).Connect(ctx, clientTransport, nil)\n    result, err := clientSession.CallTool(ctx, \u0026mcp.CallToolParams{\n        Name: \"list_networks\",\n        Arguments: map[string]any{\"site\": \"default\"},\n    })\n}\n```\n\n## Project Structure\n```\ninternal/\n├── config/\n│   ├── config.go\n│   └── config_test.go\n├── server/\n│   ├── server.go\n│   ├── server_test.go\n│   ├── lazy.go\n│   ├── lazy_test.go\n│   ├── eager.go\n│   └── eager_test.go\n```\n\n## Acceptance Criteria\n- Config loads from environment variables with proper defaults\n- go-unifi client wrapper supports both auth methods\n- MCP server starts and responds to tool list requests\n- Eager mode registers all generated tools\n- Tests achieve 90%+ coverage using in-memory transport","status":"closed","priority":1,"issue_type":"task","owner":"clayton@oneill.net","created_at":"2026-01-23T15:12:47.124943-05:00","created_by":"Clayton O'Neill","updated_at":"2026-01-24T12:37:43.797976-05:00","closed_at":"2026-01-24T12:37:43.797976-05:00","close_reason":"Phase 4 complete: config, server, and main binary implemented","dependencies":[{"issue_id":"go-unifi-mcp-08v","depends_on_id":"go-unifi-mcp-bgc","type":"blocks","created_at":"2026-01-23T15:13:25.947907-05:00","created_by":"Clayton O'Neill"}]}
{"id":"go-unifi-mcp-2fq","title":"Phase 6: Polish \u0026 Release","description":"**BEFORE STARTING:** Read the full implementation plan at:\n/Users/coneill/.claude/plans/enchanted-imagining-breeze.md\n\n## Steps\n1. Ensure 95% overall / 90% per-file coverage passes\n2. Complete README with examples\n3. Add release workflow (`.github/workflows/release.yml` with goreleaser)\n4. Test end-to-end with in-memory harness\n5. Tag v0.1.0\n\n## Release Workflow (.github/workflows/release.yml)\nTriggered on tag push, uses goreleaser to build and publish binaries.\n\n## README Content\n- Project overview and motivation\n- Installation instructions\n- Configuration (environment variables)\n- Usage examples (lazy mode, eager mode)\n- Development setup (nix develop)\n- Credits \u0026 Attribution section:\n  - filipowm/go-unifi (vendored codegen)\n  - sirkirby/unifi-network-mcp (lazy/eager pattern inspiration)\n\n## Coverage Requirements\n- Overall: 95%\n- Per-file: 90%\n- Enforced via `.testcoverage.yaml` and go-test-coverage\n\n## Final Verification\n```bash\ntask lint      # All linters pass\ntask coverage  # 95%/90% thresholds met\ntask build     # Binary builds successfully\n```\n\n## Acceptance Criteria\n- All tests pass with 95% overall / 90% per-file coverage\n- README is complete with installation, config, and usage examples\n- Release workflow creates GitHub release on tag\n- End-to-end test passes using in-memory MCP transport\n- v0.1.0 tag created and release published","status":"open","priority":1,"issue_type":"task","owner":"clayton@oneill.net","created_at":"2026-01-23T15:13:18.440786-05:00","created_by":"Clayton O'Neill","updated_at":"2026-01-23T15:13:18.440786-05:00","dependencies":[{"issue_id":"go-unifi-mcp-2fq","depends_on_id":"go-unifi-mcp-fa5","type":"blocks","created_at":"2026-01-23T15:13:26.069048-05:00","created_by":"Clayton O'Neill"}]}
{"id":"go-unifi-mcp-333","title":"Phase 1: Project Scaffolding \u0026 Tooling","description":"1. Initialize Go module (go mod init github.com/coneill/go-unifi-mcp)\n2. Create flake.nix with Go 1.24, task, golangci-lint, staticcheck, goreleaser\n3. Create .envrc (use flake, add bin/ to PATH)\n4. Create Taskfile.yml with targets: build, test, lint, gen, run\n5. Create .golangci.yaml with errorlint, gosec, govet, staticcheck, unused\n6. Create .goreleaser.yaml for multi-arch binaries + container images\n7. Create .github/workflows/ci.yaml (lint, test, build on PRs)\n8. Create .github/workflows/release.yaml (goreleaser on tags)\n9. Add main.go stub (package main, placeholder main())\n10. Add go.sum (run go mod tidy after adding dependencies)\n11. Add initial README.md with project description\n12. Add LICENSE file (MIT)\n13. Verify: task build should compile\n14. Verify: task lint should pass","status":"tombstone","priority":2,"issue_type":"task","owner":"clayton@oneill.net","created_at":"2026-01-23T15:10:28.168266-05:00","created_by":"Clayton O'Neill","updated_at":"2026-01-23T15:13:46.866853-05:00","deleted_at":"2026-01-23T15:13:46.866853-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"task"}
{"id":"go-unifi-mcp-35g","title":"go-unifi-mcp: MCP server wrapping go-unifi","description":"An MCP server that wraps go-unifi, exposing all UniFi API methods as MCP tools with context optimization (lazy/eager modes).\n\n**BEFORE STARTING ANY WORK:** Read the full implementation plan at:\n/Users/coneill/.claude/plans/enchanted-imagining-breeze.md\n\n## Overview\n- Language: Go\n- MCP SDK: modelcontextprotocol/go-sdk\n- Code Generation: Two-stage pipeline (clone go-unifi at build, reuse upstream field parsing)\n- Context Optimization: Meta-tool pattern with lazy/eager modes\n- Build Tool: Taskfile\n- Config: Environment variables only\n- Test Coverage: 95% overall, 90% per-file (enforced from start)\n\n## Key Architecture\n- Lazy mode (default): 3 meta-tools (unifi_tool_index, unifi_execute, unifi_batch)\n- Eager mode: All 80+ tools registered directly\n- Vendor go-unifi codegen parsing, write thin MCP generator\n\n## Phases\n1. Project Scaffolding \u0026 Tooling\n2. Vendor go-unifi Codegen\n3. MCP Templates \u0026 Generator\n4. MCP Server Core\n5. Meta-Tools \u0026 Lazy Mode\n6. Polish \u0026 Release","status":"open","priority":1,"issue_type":"epic","owner":"clayton@oneill.net","created_at":"2026-01-23T15:11:40.600018-05:00","created_by":"Clayton O'Neill","updated_at":"2026-01-23T15:11:40.600018-05:00","dependencies":[{"issue_id":"go-unifi-mcp-35g","depends_on_id":"go-unifi-mcp-chr","type":"blocks","created_at":"2026-01-23T15:13:33.502253-05:00","created_by":"Clayton O'Neill"},{"issue_id":"go-unifi-mcp-35g","depends_on_id":"go-unifi-mcp-61b","type":"blocks","created_at":"2026-01-23T15:13:33.564492-05:00","created_by":"Clayton O'Neill"},{"issue_id":"go-unifi-mcp-35g","depends_on_id":"go-unifi-mcp-bgc","type":"blocks","created_at":"2026-01-23T15:13:33.628698-05:00","created_by":"Clayton O'Neill"},{"issue_id":"go-unifi-mcp-35g","depends_on_id":"go-unifi-mcp-08v","type":"blocks","created_at":"2026-01-23T15:13:33.690746-05:00","created_by":"Clayton O'Neill"},{"issue_id":"go-unifi-mcp-35g","depends_on_id":"go-unifi-mcp-fa5","type":"blocks","created_at":"2026-01-23T15:13:33.751603-05:00","created_by":"Clayton O'Neill"},{"issue_id":"go-unifi-mcp-35g","depends_on_id":"go-unifi-mcp-2fq","type":"blocks","created_at":"2026-01-23T15:13:33.812832-05:00","created_by":"Clayton O'Neill"}]}
{"id":"go-unifi-mcp-61b","title":"Phase 2: Vendor go-unifi Codegen","description":"**BEFORE STARTING:** Read the full implementation plan at:\n/Users/coneill/.claude/plans/enchanted-imagining-breeze.md\n\n## Steps\n1. Create `.go-unifi-version` file with pinned version\n2. Create `task sync-gounifi` that:\n   - Clones go-unifi at pinned version to `.tmp/go-unifi/`\n   - Copies `codegen/{resources,customize,validation}.go` to `internal/gounifi/`\n   - Patches `package main` → `package gounifi`\n   - Adds attribution headers to each file\n3. Create `internal/gounifi/README.md` with prominent attribution\n4. Add Renovate custom manager for `.go-unifi-version`\n5. Write integration test that imports gounifi and parses a sample JSON spec\n\n## Why Vendor?\ngo-unifi's codegen is `package main` and cannot be imported directly.\nWe copy these files and change the package name to `gounifi` to reuse\ntheir JSON parsing and type inference logic.\n\n## Files to Vendor (parsing infrastructure only)\n- `resources.go` - Resource, FieldInfo structs, JSON parsing, type inference\n- `customize.go` - Field customization system\n- `validation.go` - Regex-based validation helpers\n\n## Attribution Requirements\nEach vendored file needs this header:\n```go\n// Code in this file is copied from github.com/filipowm/go-unifi/codegen\n// Licensed under MPL-2.0 - https://github.com/filipowm/go-unifi/blob/main/LICENSE\n//\n// DO NOT EDIT MANUALLY - synced from upstream via \\`task sync-gounifi\\`\n// Source version: see ../.go-unifi-version\n```\n\n## Acceptance Criteria\n- `task sync-gounifi` successfully clones and patches go-unifi codegen\n- `internal/gounifi/` contains patched files with proper attribution\n- Integration test passes: can parse JSON specs using vendored code\n- Renovate config includes custom manager for version file","status":"closed","priority":1,"issue_type":"task","owner":"clayton@oneill.net","created_at":"2026-01-23T15:12:15.656598-05:00","created_by":"Clayton O'Neill","updated_at":"2026-01-23T19:03:24.577768-05:00","closed_at":"2026-01-23T19:03:24.577768-05:00","close_reason":"Vendored go-unifi codegen to internal/gounifi/, build passes, lint passes","dependencies":[{"issue_id":"go-unifi-mcp-61b","depends_on_id":"go-unifi-mcp-chr","type":"blocks","created_at":"2026-01-23T15:13:25.825499-05:00","created_by":"Clayton O'Neill"}]}
{"id":"go-unifi-mcp-bgc","title":"Phase 3: MCP Templates \u0026 Generator","description":"**BEFORE STARTING:** Read the full implementation plan at:\n/Users/coneill/.claude/plans/enchanted-imagining-breeze.md\n\n## Steps\n1. Create `tool.go.tmpl` - MCP tool implementation template\n2. Create `tool_test.go.tmpl` - Generated test template\n3. Create `manifest.json.tmpl` - Static manifest template\n4. Create `registry.go.tmpl` - Tool registry template\n5. Write thin generator (~50 lines): call vendored parsing → render templates\n6. Write unit tests for generator (90%+ coverage)\n\n## Generator Architecture\nThe generator imports vendored parsing code:\n```go\nimport \"github.com/claytono/go-unifi-mcp/internal/gounifi\"\n\nfunc main() {\n    resources, _ := gounifi.BuildResourcesFromDownloadedFields(\n        \".tmp/go-unifi/codegen/fields\",\n        customizer,\n        false,\n    )\n    for _, r := range resources {\n        generateMCPTool(r)  // Our MCP template\n    }\n}\n```\n\n## CRUD Operations Inference\nUses go-unifi's `IsSetting()` method:\n| Resource Type | Detection | Operations |\n|--------------|-----------|------------|\n| Settings | `r.IsSetting()` returns true | get, update |\n| Device | `r.StructName == \"Device\"` | list, get |\n| All others | Default | list, get, create, update, delete |\n\n## Generated Output\n- `internal/tools/*.gen.go` - Tool implementations\n- `internal/tools/*_test.gen.go` - Generated tests\n- `internal/manifest/manifest.gen.json` - Static manifest\n- `internal/registry/registry.gen.go` - Tool registry\n\n## Acceptance Criteria\n- Templates render valid Go code\n- Generator produces 80+ tool files from go-unifi specs\n- Generated tests compile and pass\n- Manifest JSON is valid and contains all tools\n- Generator has 90%+ test coverage","status":"closed","priority":1,"issue_type":"task","owner":"clayton@oneill.net","created_at":"2026-01-23T15:12:30.549911-05:00","created_by":"Clayton O'Neill","updated_at":"2026-01-24T01:38:12.738875-05:00","closed_at":"2026-01-24T01:38:12.738875-05:00","close_reason":"Implemented MCP Templates \u0026 Generator: 242 tools generated, 88.2% test coverage","dependencies":[{"issue_id":"go-unifi-mcp-bgc","depends_on_id":"go-unifi-mcp-61b","type":"blocks","created_at":"2026-01-23T15:13:25.886689-05:00","created_by":"Clayton O'Neill"}]}
{"id":"go-unifi-mcp-chr","title":"Phase 1: Project Scaffolding \u0026 Tooling","description":"**BEFORE STARTING:** Read the full implementation plan at:\n/Users/coneill/.claude/plans/enchanted-imagining-breeze.md\n\n## Steps\n1. Initialize Go module (`go mod init github.com/claytono/go-unifi-mcp`)\n2. Create `flake.nix` with all dev dependencies (include go-test-coverage)\n3. Create `.envrc` for direnv\n4. Create `Taskfile.yml` with tasks: `lint`, `test`, `coverage`, `generate`, `build`\n5. Create `.pre-commit-config.yaml` with all hooks\n6. Create `.golangci.yml` linter config\n7. Create `scripts/lint`\n8. Create `.testcoverage.yaml` with 95%/90% thresholds\n9. Create `.github/workflows/ci.yml` (Nix-based, run lint + coverage)\n10. Create `.github/renovate.json`\n11. Initialize beads (`.beads/config.yaml`) - ALREADY DONE\n12. Write `CLAUDE.md`\n13. Write initial `README.md`\n14. Create `.goreleaser.yml`\n\n## Key Configs from Plan\n\n### Nix Packages (flake.nix)\n- go (pinned version, Renovate-managed)\n- golangci-lint, go-task, pre-commit, goreleaser, mockery, go-test-coverage\n\n### Pre-commit Hooks\n- trailing-whitespace, end-of-file-fixer, check-added-large-files, check-merge-conflict\n- prettier (json, markdown, yaml)\n- golangci-lint (with --fix)\n- shellcheck\n- renovate-config-validator\n- go-test-coverage (pre-push stage)\n- beads-flush (pre-commit stage)\n\n### Coverage Thresholds (.testcoverage.yaml)\n```yaml\nprofile: coverage.out\nthreshold:\n  total: 95\n  file: 90\n```\n\n## Acceptance Criteria\n- `nix develop` drops into working environment\n- `task lint` runs successfully\n- `task test` runs (no tests yet, but infrastructure works)\n- Pre-commit hooks installed and functional\n- CI workflow triggers on PR","status":"closed","priority":1,"issue_type":"task","owner":"clayton@oneill.net","created_at":"2026-01-23T15:11:57.100212-05:00","created_by":"Clayton O'Neill","updated_at":"2026-01-23T18:06:13.397141-05:00","closed_at":"2026-01-23T18:06:13.397141-05:00","close_reason":"Phase 1 complete - all scaffolding files created and pushed to origin"}
{"id":"go-unifi-mcp-e4n","title":"go-unifi-mcp: MCP server wrapping go-unifi","description":"An MCP server that wraps go-unifi, exposing all UniFi API methods as MCP tools with context optimization (lazy/eager modes).","status":"tombstone","priority":1,"issue_type":"epic","owner":"clayton@oneill.net","created_at":"2026-01-23T15:10:19.899389-05:00","created_by":"Clayton O'Neill","updated_at":"2026-01-23T15:13:46.805408-05:00","deleted_at":"2026-01-23T15:13:46.805408-05:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"epic"}
{"id":"go-unifi-mcp-fa5","title":"Phase 5: Meta-Tools \u0026 Lazy Mode","description":"**BEFORE STARTING:** Read the full implementation plan at:\n/Users/coneill/.claude/plans/enchanted-imagining-breeze.md\n\n## Steps\n1. Implement `unifi_tool_index` - read from generated manifest\n2. Implement `unifi_execute` - dispatcher to actual tools\n3. Implement `unifi_batch` - parallel execution\n4. Implement lazy mode tool loading\n5. Write integration tests (90%+ coverage)\n\n## Context Optimization (Lazy/Eager Modes)\n\n### Lazy Mode (Default) - ~200 tokens\nOnly 3 meta-tools registered initially:\n1. **`unifi_tool_index`** - Returns full tool catalog from static manifest\n2. **`unifi_execute`** - Executes a tool by name with arguments\n3. **`unifi_batch`** - Executes multiple tools in parallel\n\n### Eager Mode - ~5000 tokens\nAll 80+ tools registered directly. Useful for development/debugging.\n\n## Project Structure\n```\ninternal/\n├── meta/                  # Meta-tools (hand-written)\n│   ├── tool_index.go\n│   ├── tool_index_test.go\n│   ├── execute.go\n│   ├── execute_test.go\n│   ├── batch.go\n│   └── batch_test.go\n```\n\n## Integration Test\n```go\nfunc TestLazyModeE2E(t *testing.T) {\n    server := NewServer(testConfig)\n    st, ct := mcp.NewInMemoryTransports()\n    _, _ = server.Connect(ctx, st, nil)\n    client, _ := mcp.NewClient(...).Connect(ctx, ct, nil)\n\n    // List tools - should only see meta-tools\n    tools, _ := client.ListTools(ctx, nil)\n    assert.Len(t, tools.Tools, 3)\n\n    // Call tool_index\n    result, _ := client.CallTool(ctx, \u0026mcp.CallToolParams{\n        Name: \"unifi_tool_index\",\n    })\n    // Assert 80+ tools in manifest\n\n    // Execute a tool via unifi_execute\n    result, _ = client.CallTool(ctx, \u0026mcp.CallToolParams{\n        Name: \"unifi_execute\",\n        Arguments: map[string]any{\n            \"tool\": \"list_networks\",\n            \"arguments\": map[string]any{\"site\": \"default\"},\n        },\n    })\n}\n```\n\n## Acceptance Criteria\n- Lazy mode exposes exactly 3 meta-tools\n- `unifi_tool_index` returns complete manifest with 80+ tools\n- `unifi_execute` correctly dispatches to underlying tools\n- `unifi_batch` executes multiple tools in parallel\n- Mode switching works via UNIFI_TOOL_MODE env var\n- Tests achieve 90%+ coverage","status":"open","priority":1,"issue_type":"task","owner":"clayton@oneill.net","created_at":"2026-01-23T15:13:04.606859-05:00","created_by":"Clayton O'Neill","updated_at":"2026-01-23T15:13:04.606859-05:00","dependencies":[{"issue_id":"go-unifi-mcp-fa5","depends_on_id":"go-unifi-mcp-08v","type":"blocks","created_at":"2026-01-23T15:13:26.008282-05:00","created_by":"Clayton O'Neill"}]}
